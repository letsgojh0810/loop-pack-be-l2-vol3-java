# 01. 요구사항 명세

## 1. 개요

감성 이커머스 플랫폼의 핵심 도메인(브랜드, 상품, 좋아요, 주문)에 대한 기능 요구사항을 정의한다.
회원 도메인은 1주차에 구현 완료되었으므로 이 문서에서 제외한다.

### 액터

| 액터 | 설명 | 인증 방식 |
|------|------|-----------|
| 고객 (User) | 상품 탐색, 좋아요, 주문을 수행하는 일반 사용자 | `X-Loopers-LoginId` + `X-Loopers-LoginPw` |
| 어드민 (Admin) | 브랜드/상품/주문을 관리하는 사내 운영자 | `X-Loopers-Ldap: loopers.admin` |
| 시스템 | 재고 차감, 스냅샷 저장 등 자동화된 내부 처리 | - |

### 핵심 도메인

| 도메인 | 핵심 책임 |
|--------|-----------|
| Brand | 상품을 묶는 브랜드 단위. 어드민이 관리한다. |
| Product | 가격, 재고를 가진 판매 단위. 브랜드에 종속된다. |
| ProductLike | 고객의 상품 관심 표시. 향후 랭킹/추천 데이터 기반이 된다. |
| Order / OrderItem | 고객의 구매 행위. 주문 시점의 상품 정보를 스냅샷으로 보존한다. |

---

## 2. 설계 판단 (보편적 이커머스 기준)

요구사항에서 명시되지 않은 부분에 대해 다음과 같이 판단했다.

| 항목 | 결정 | 근거 |
|------|------|------|
| 삭제 전략 | Soft Delete (`deletedAt`) | BaseEntity에 이미 내장. 주문 이력/좋아요 데이터 보존 필요. |
| 주문 완료 조건 | 선결 조건(상품 존재, 재고 충분) 충족 시 즉시 주문 완료 | 결제 없음. 상태 관리 불필요. |
| 좋아요 멱등성 | 이미 좋아요한 상태에서 재요청 시 무시(200 OK) | 클라이언트 구현 편의, 네트워크 재시도 안전성. |
| 좋아요 취소 멱등성 | 이미 취소된 상태에서 재요청 시 무시(200 OK) | 동일 근거. |
| 좋아요 목록 조회 | 본인만 가능 (userId ≠ 로그인 유저 시 403) | 소셜 기능 요구 없음. |
| 주문 스냅샷 범위 | 상품명, 상품 가격, 브랜드명, 수량 | 주문 이력 화면 재현에 충분한 최소 정보. |
| 상품 재고 | Product에 `stock` 필드 | 주문 시 차감 요구사항 충족. |
| 주문 목록 페이지네이션 | 날짜 범위 + page/size | 데이터 증가에 대비. |
| 브랜드 삭제 시 상품 처리 | 브랜드 soft delete → 해당 상품도 일괄 soft delete | 요구사항 명시 + 주문/좋아요 이력 보존. |
| 삭제된 상품 좋아요 | 삭제된 상품에 좋아요 불가, 기존 좋아요는 목록에서 필터링 | 자연스러운 UX. |

---

## 3. 기능 요구사항

### 3.1 브랜드 (Brand)

#### 고객 API (`/api/v1`)

| 기능 | METHOD | URI | 인증 | 설명 |
|------|--------|-----|------|------|
| 브랜드 조회 | GET | `/api/v1/brands/{brandId}` | X | 단일 브랜드 정보를 조회한다. 삭제된 브랜드는 404. |

**고객에게 제공하는 브랜드 정보:** id, 이름, 설명, 이미지 URL

#### 어드민 API (`/api-admin/v1`)

| 기능 | METHOD | URI | 인증 | 설명 |
|------|--------|-----|------|------|
| 브랜드 목록 조회 | GET | `/api-admin/v1/brands?page=0&size=20` | LDAP | 등록된 브랜드 목록 (페이지네이션) |
| 브랜드 상세 조회 | GET | `/api-admin/v1/brands/{brandId}` | LDAP | 단일 브랜드 상세 정보 |
| 브랜드 등록 | POST | `/api-admin/v1/brands` | LDAP | 새 브랜드 등록 |
| 브랜드 수정 | PUT | `/api-admin/v1/brands/{brandId}` | LDAP | 브랜드 정보 수정 |
| 브랜드 삭제 | DELETE | `/api-admin/v1/brands/{brandId}` | LDAP | 브랜드 soft delete + 해당 상품 일괄 soft delete |

**어드민에게 추가 제공하는 정보:** createdAt, updatedAt, deletedAt, 소속 상품 수

**브랜드 등록/수정 시 검증:**
- 이름: 필수, 빈 값 불가
- 이름 중복: 동일 이름 브랜드 등록 불가 (CONFLICT)

---

### 3.2 상품 (Product)

#### 고객 API (`/api/v1`)

| 기능 | METHOD | URI | 인증 | 설명 |
|------|--------|-----|------|------|
| 상품 목록 조회 | GET | `/api/v1/products` | X | 상품 목록 (필터 + 정렬 + 페이지네이션) |
| 상품 상세 조회 | GET | `/api/v1/products/{productId}` | X | 단일 상품 정보. 삭제된 상품은 404. |

**상품 목록 쿼리 파라미터:**

| 파라미터 | 타입 | 기본값 | 설명 |
|----------|------|--------|------|
| `brandId` | Long | - | 특정 브랜드 필터링 (선택) |
| `sort` | String | `latest` | 정렬 기준: `latest`, `price_asc`, `likes_desc` |
| `page` | int | 0 | 페이지 번호 |
| `size` | int | 20 | 페이지당 상품 수 |

**고객에게 제공하는 상품 정보:** id, 상품명, 설명, 가격, 재고, 이미지 URL, 브랜드 정보(id, 이름), 좋아요 수

#### 어드민 API (`/api-admin/v1`)

| 기능 | METHOD | URI | 인증 | 설명 |
|------|--------|-----|------|------|
| 상품 목록 조회 | GET | `/api-admin/v1/products?page=0&size=20&brandId={brandId}` | LDAP | 등록된 상품 목록 |
| 상품 상세 조회 | GET | `/api-admin/v1/products/{productId}` | LDAP | 상품 상세 정보 |
| 상품 등록 | POST | `/api-admin/v1/products` | LDAP | 새 상품 등록 |
| 상품 수정 | PUT | `/api-admin/v1/products/{productId}` | LDAP | 상품 정보 수정 |
| 상품 삭제 | DELETE | `/api-admin/v1/products/{productId}` | LDAP | 상품 soft delete |

**상품 등록 시 제약:**
- 브랜드: 반드시 이미 등록된(삭제되지 않은) 브랜드여야 함
- 상품명: 필수
- 가격: 0 이상
- 재고: 0 이상

**상품 수정 시 제약:**
- 브랜드는 변경 불가
- 나머지 필드만 수정 가능

---

### 3.3 좋아요 (ProductLike)

| 기능 | METHOD | URI | 인증 | 설명 |
|------|--------|-----|------|------|
| 좋아요 등록 | POST | `/api/v1/products/{productId}/likes` | O | 상품에 좋아요. 멱등 처리 (이미 있으면 무시). |
| 좋아요 취소 | DELETE | `/api/v1/products/{productId}/likes` | O | 좋아요 해제. 멱등 처리 (없으면 무시). |
| 내 좋아요 목록 | GET | `/api/v1/users/{userId}/likes` | O | 본인이 좋아요한 상품 목록. userId ≠ 본인이면 403. |

**좋아요 등록 제약:**
- 삭제된 상품에는 좋아요 불가 (404)
- 이미 좋아요한 상태에서 재요청 시 200 OK (멱등)

**좋아요 목록 응답:**
- 좋아요한 상품 정보 (id, 상품명, 가격, 브랜드명, 이미지 URL)
- 삭제된 상품은 목록에서 제외

---

### 3.4 주문 (Order)

#### 고객 API (`/api/v1`)

| 기능 | METHOD | URI | 인증 | 설명 |
|------|--------|-----|------|------|
| 주문 생성 | POST | `/api/v1/orders` | O | 다건 상품 주문. 재고 확인 및 차감. 스냅샷 저장. |
| 주문 목록 조회 | GET | `/api/v1/orders?startAt=..&endAt=..&page=0&size=20` | O | 기간별 주문 목록 |
| 주문 상세 조회 | GET | `/api/v1/orders/{orderId}` | O | 단일 주문 상세 (주문 항목 포함) |

**주문 생성 요청:**
```json
{
  "items": [
    { "productId": 1, "quantity": 2 },
    { "productId": 3, "quantity": 1 }
  ]
}
```

**주문 생성 시 처리 흐름:**
1. 요청된 상품들이 모두 존재하고 삭제되지 않았는지 확인
2. 각 상품의 재고가 요청 수량 이상인지 확인
3. 재고 차감
4. 주문 시점의 상품 정보를 OrderItem에 스냅샷으로 저장 (상품명, 가격, 브랜드명)
5. 총 주문 금액 계산 (각 항목의 가격 x 수량의 합)
6. Order 생성 (선결 조건 통과 = 주문 완료)

**주문 생성 실패 조건:**
- 상품이 존재하지 않거나 삭제됨 → 404
- 재고 부족 → 400 (어떤 상품이 부족한지 메시지에 포함)
- 주문 항목이 비어있음 → 400

**주문 상세 조회:**
- 본인의 주문만 조회 가능 (타인 주문 접근 시 403)
- 주문 정보: id, 총 금액, 주문 일시
- 주문 항목: 상품 스냅샷(상품명, 가격, 브랜드명), 수량, 소계

#### 어드민 API (`/api-admin/v1`)

| 기능 | METHOD | URI | 인증 | 설명 |
|------|--------|-----|------|------|
| 주문 목록 조회 | GET | `/api-admin/v1/orders?page=0&size=20` | LDAP | 전체 주문 목록 (페이지네이션) |
| 주문 상세 조회 | GET | `/api-admin/v1/orders/{orderId}` | LDAP | 단일 주문 상세 (주문자 정보 포함) |

